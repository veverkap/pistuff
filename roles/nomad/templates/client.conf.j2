bind_addr = "0.0.0.0"
data_dir = "/var/lib/nomad"
region = "{{ nomad_dc }}"
datacenter = "{{ nomad_dc }}"
name = "{{ ansible_hostname }}.node"
log_level = "DEBUG"
enable_debug = true

advertise {
  # We need to specify our host's IP because we can't
  # advertise 0.0.0.0 to other nodes in our cluster.
  rpc = "{{ ansible_default_ipv4.address }}:4647"
}

client {
  enabled = true
  host_volume "movies" {
    path = "/mnt/movies"
    read_only = false
  }

  host_volume "tv" {
    path = "/mnt/tv"
    read_only = false
  }

  host_volume "nomadconfig" {
    path = "/opt/nomad/configs"
    read_only = false
  }


{%- if ansible_hostname == "rpi1" -%}

  host_volume "moviesfolder" {
    path = "/mnt/external/Movies"
    read_only = false
  }

  host_volume "moviessync" {
    path = "/mnt/external/Sync"
    read_only = false
  }

  host_volume "tautulliconfig" {
    path = "/opt/nomad/configs/tautulli"
    read_only = false
  }

  host_volume "radarrconfig" {
    path = "/opt/nomad/configs/radarr"
    read_only = false
  }

 {%- endif -%}

{%- if ansible_hostname == "rpi4" -%}

  host_volume "sonarrconfig" {
    path = "/opt/nomad/configs/sonarr"
    read_only = false
  }

 {%- endif -%}

  servers = {{ nomad_retry_join }}
}
